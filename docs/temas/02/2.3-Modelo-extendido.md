# **2.3 El modelo Entidad Relaci贸n Extendido**

Con el paso de los a帽os, y dadas ciertas carencias del modelo entidad relaci贸n, a mediados de los a帽os 80 se extendi贸 con la incorporaci贸n de los conceptos de clase y subclase, junto con los conceptos de generalizaci贸n y especializaci贸n, as铆 como la agregaci贸n de entidades, dando lugar al modelo _Entidad Relaci贸n Extendido_ (**EER**).

##  **Generalizaci贸n**

La descomposici贸n de tipos de entidad en varios subtipos o subclases permite identificar jerarqu铆as de entidades, entre una entidad general, que denominamos entidad superclase (o entidad padre), que se puede especializar en entidades subclase (o entidades hijas):

- La entidad **superclase** modelan las caracter铆sticas comunes de la entidad vista de una forma gen茅rica.
- Las entidades **subclase** modelan las caracter铆sticas propias de sus especializaciones.

Es necesario que se cumpla que toda ocurrencia de una entidad subclase sea tambi茅n una ocurrencia de su entidad superclase, propagando sus caracter铆sticas de padres a hijos, lo que se denomina _herencia de propiedades_.

**Generalizaci贸n vs Especializaci贸n**

Se dice que tenemos una **generalizacion**, cuando dos o mas tipos de entidades van a compartir diferentes atributos. Para ello, la entidad superclase contendr谩 aquellos atributos comunes a las subclases. En cambio, se dice que realizamos una especializaci贸n cuando un tipo de entidad tiene algunos atributos que tienen sentido para algunas subclases, pero no para todas. Para ello, cada subclase contendr谩 sus atributos espec铆ficos, y los comunes se colocan en la superclase.

As铆 pues, se dice que la generalizaci贸n va de abajo hacia arriba, subiendo los atributos comunes al padre, y en consecuencia, la especializaci贸n va de arriba a abajo, colocando en los hijos los atributos espec铆ficos que no comparten todas las subclases.

Con generalizaci贸n y la especializaci贸n se establece una relaci贸n **_ES-UN_** (en ingl茅s, _IS-A_), indicando que una entidad hijo ES-UN con la entidad padre. Por ejemplo, si la superclase es `VEHICULO`, ejemplos de subclases ser铆an `CAMION`, `AUTOBUS`, `MOTO`, etc... ya que un `CAMION` es un `VEHICULO`.

En la generalizaci贸n/especializaci贸n, las caracter铆sticas (atributos o interrelaciones) de la entidad superclase se propagan hacia las entidades subclase. Es lo que se denomina **herencia de propiedades**.

<figure markdown="span">
  <img src="images/02generalizacion.png" width="80%">
  <figcaption>Generalizaci贸n</figcaption>
</figure>

Las **generalizaciones** siempre se representan en vertical, situando la entidad superclase arriba y las subclases debajo. Para conectarlas, se utiliza un c铆rculo que puede contener la letra `d` o la letra `o` de forma similar al ejemplo que tenemos en el lateral, para indicar que la especializaci贸n es disjunta o solapada (_overlap_). Entre la clase padre y el c铆rculo, si se utiliza una l铆nea simple indicamos que es una especializaci贸n parcial y si es doble, que se trata de una generalizaci贸n total.

Finalmente, el circulo conecta con los hijos mediante una l铆nea que contiene un arco indicando el sentido del padre a los hijos.

As铆 pues, en el ejemplo tenemos que un `LIBRO` tiene un isbn y un t铆tulo. Y que un `EBOOK` _ES-UN_ `LIBRO` y que `EN_PAPEL` tambi茅n _ES-UN_ `LIBRO`. Un `EBOOK` en total tiene tres atributos, los dos que hereda del padre, m谩s el formato del _ebook_. De forma similar, `EN_PAPEL`, tambi茅n tiene tres atributos, los dos que hereda de `LIBRO` m谩s el n煤mero de p谩ginas de la copia impresa.

###  Tipos

Cuando definimos una especializaci贸n es muy importante definir c贸mo se relacionan las superclases con las subclases.

Vamos a centrarnos en un supuesto donde tenemos una superclase `EMPLEADO` y tenemos tres subclases: `DIRECTIVO`, `TECNICO` y `COMERCIAL`.

Si nos centramos en la cantidad de subtipos posibles tenemos:

- **Total**: La superclase pertenece obligatoriamente a alguna de las subclases. No puede haber un `EMPLEADO` que no sea ni `DIRECTIVO`, ni `TECNICO`, ni `COMERCIAL`. Se representa uniendo mediante una l铆nea doble (`||`) la superclase con el c铆rculo.
- **Parcial**: La superclase puede no pertenecer a alguna de las subclases. Podr铆amos tener un `EMPLEADO` que no sea ni `DIRECTIVO`, ni `TECNICO`, ni `COMERCIAL`. Se representa uniendo mediante una l铆nea sencilla (`|`) la superclase con el c铆rculo.

Y si ponemos en foco en la exclusividad de las subclases:

- **Disjunta** / Exclusiva: La superclase s贸lo pertenece a una de las subclases. Si un `EMPLEADO` es un `DIRECTIVO`, no puede ser un `TECNICO` ni un `COMERCIAL`. Se representa poniendo una **`d`** dentro del c铆rculo.
- **Solapada**: La superclase puede pertenecer a varias de las subclases a la vez. Un `EMPLEADO` puede ser un `DIRECTIVO` y un `COMERCIAL` a la vez. Se representa poniendo una **`o`** dentro del c铆rculo.

Con lo cual, se pueden dar las siguientes combianciones:

<figure markdown="span">
  <img src="images/02isa-tipos.png" width="100%">
  <figcaption>Tipos de relaciones IS-a</figcaption>
</figure>

??? fix "Otras formas de representar este tipo de relaciones:"

    <figure markdown="span">
      <img src="images/02isaTiposAlternative.png" width="100%">
      <figcaption>Tipos de relaciones IS-a (representaci贸n alternativa)</figcaption>
    </figure>


!!! tip "Supuesto IV Tienda"

    Se pide dise帽ar la base de datos de una tienda, la cual est谩 organizada por departamentos, que contenga informaci贸n sobre los trabajadores y los art铆culos que se ofertan.

    Se deben tener en cuenta las siguientes restricciones:

    De todos los trabajadores nos interesa almacenar su DNI, nombre completo y n煤mero de tel茅fono, as铆 como el departamento en el que trabajan.
    Existen tres tipos de trabajadores: gerentes (del que guardaremos el bonus anual), jefes (nos interesa almacenar cuantos vendedores tiene a su cargo) y vendedores (de cada vendedor, guardaremos su sueldo base y la zona donde trabaja).
    Cada departamento lo dirige un gerente, aunque se puede dar el caso que tengamos gerentes que no dirijan ning煤n departamento, pero nunca dirigir谩n m谩s de uno.
    Un gerente tiene a su cargo a un cierto n煤mero de jefes y 茅stos a su vez a un cierto n煤mero de vendedores.
    En cuanto a los productos nos interesa su c贸digo, nombre y precio, y departamento en el que se encuentran.
    Cada producto lo pueden vender muchos vendedores, y cada vendedor, a su vez, puede vender muchos productos. Adem谩s, cada vendedor le aplicar谩 un determinado descuento a los productos con los que trabaja.

    ??? solution "Soluci贸n"

        Primero localizamos las entidades y sus atributos:

        - **Entidades**: TRABAJADOR, DPTO, PRODUCTO. Los trabajadores a su vez, se descomponen en las subclases VENDEDOR, JEFE y GERENTE.
        - **Atributos**: los trabajadores se identifican por su dni, mientras que los departamentos y los productos por su codigo.

        Las relaciones son:

        - **Relaci贸n 1:N** nombrada como PERTENECER entre TRABAJADOR Y DPTO, ya que de los trabajadores nos interesa "el departamento en el que trabajan" y se entiende que a un departamento pertenecer谩n varios trabajadores.
        - Generalizaci贸n total y disjunta entre TRABAJADOR y sus hijos VENDEDOR, JEFE y GERENTE, cada uno con sus propios atributos. Destacar que el atributo de cantVendedores es derivado, ya que se obtiene de la cardinalidad de la relaci贸n SUPERVISAR.
        - **Relaci贸n 1:1** nombrada como DIRIGIR entre DPTO Y GERENTE, ya que "Cada departamento lo dirige un gerente, aunque se puede dar el caso que tengamos gerentes que no dirijan ning煤n departamento, pero nunca dirigir谩n m谩s de uno"
        - **Relaci贸n 1:N** nombrada como MANDAR entre GERENTE Y JEFE, ya que "Un gerente tiene a su cargo a un cierto n煤mero de jefes".
        - **Relaci贸n 1:N** nombrada como SUPERVISAR entre JEFE Y VENDEDOR, continuando "y 茅stos (los jefes) a su vez a un cierto n煤mero de vendedores".
        - **Relaci贸n 1:N** nombrada como ENCONTRAR entre DPTO Y PRODUCTO, ya que "En cuanto a los productos nos interesa ... departamento en el que se encuentran", y entendemos que en un departamento encontraremos varios productos.
        - **Relaci贸n N:M** nombrada como VENDER entre VENDEDOR y PRODUCTO, ya que "Cada producto lo pueden vender muchos vendedores, y cada vendedor, a su vez, puede vender muchos productos". Adem谩s, a帽adimos el atributo descuento en la relaci贸n para almacenar el descuento que cada vendedor aplica a los productos.

        <figure markdown="span">
          <img src="images/02solucion-tienda.png" width="100%">
          <figcaption>Soluci贸n</figcaption>
        </figure>

## 锔 **Agregaci贸n**

La agregaci贸n surge de la limitaci贸n que existe en el modelo ER de no permitir expresar relaciones entre relaciones binarias, y en gran medida, haciendo uso de agregaciones podemos evitar hacer uso de relaciones ternarias.

As铆 pues, una agregaci贸n se comporta como una entidad m谩s, con un nivel de abstracci贸n mayor que la propia relaci贸n.

!!! example "Ejemplo Agregaci贸n"

    Por ejemplo, tengamos el caso de un docente que imparte clase en una determinada aula. El docente dar谩 clase a varios grupos en el aula, y en el aula entran varios docentes. Queda claro que una relaci贸n N:M entre `DOCENTE` y `AULA` (por ejemplo, `IMPARTIR`) nos permite modelar este caso. Pero 驴y si queremos registrar las incidencias que se producen en el aula cuando un docente est谩 dando clase? Si unimos la entidad `INCIDENCIA` con `DOCENTE` o con `AULA`, estar铆amos perdiendo informaci贸n.

    <figure markdown="span">
      <img src="images/02agregacion.png" width="50%">
      <figcaption>Agregaci贸n</figcaption>
    </figure>


    As铆 pues, creamos una **entidad asociativa** que funciona como una **agregaci贸n**, y la nombramos, por ejemplo como `SESION` (una sesi贸n lectiva la imparte un docente en un aula) y 茅sta es la que relacionamos con la entidad `INCIDENCIA` mediante la relaci贸n `REGISTRAR`. Es importante destacar que la entidad asociativa no tiene atributo identificador, porque realmente es como si tuviera una restricci贸n de identificaci贸n respecto a las otras entidades, a modo de entidad d茅bil que necesita de todas las entidades con las que se asocia para identificarse.

El **mecanismo de agregaci贸n** lo que hace es abstraer las entidades y la relaci贸n que las asocia para obtener una **entidad compleja**, conocida como **entidad asociativa**, que a su vez puede relacionarse como una entidad normal con el resto de entidades de nuestro sistema.

Aunque tiene muchos puntos de contacto con una relaci贸n ternaria, la agregaci贸n remarca la relaci贸n entre una determinada pareja de entidades, al mismo tiempo que **no implica una necesaria asociaci贸n con la tercera entidad**, como si ocurre en las ternarias.