# **2.2 Restricciones**

En el apartado de [Entidades](./2.1-ModeloER.md#Ô∏èentidades) vimos que tenemos entidades fuertes y d√©biles, y en las d√©biles su existencia depende de otra entidad, de manera que se identifica por sus propiedades y por las propiedades de las entidades de las que depende.

## üÜî **Existencia e identificaci√≥n**

Las entidades d√©biles, que representamos mediante un doble rect√°ngulo, presentan dos tipos de dependencia:

- Dependencia en **existencia**: la entidad d√©bil no puede existir sin la entidad d√©bil, lo que implica que, si desaparece una instancia de entidad fuerte desaparecer√°n las instancias de entidad d√©biles que dependan de la primera. La representaci√≥n de este tipo de dependencia incluir√° una `E` en el conector o en el interior de la relaci√≥n d√©bil. En todos casos las restricciones de existencia implican que la cardinalidad m√≠nima es 1.
    
- Dependencia en **identificaci√≥n**: debe darse una dependencia en existencia y adem√°s, una ocurrencia de la entidad d√©bil no puede identificarse por s√≠ misma, debiendo hacerse mediante los atributos identificadores de la entidad fuerte asociada. La representaci√≥n de este tipo de dependencia incluir√° una `ID` en el conector o en el interior de la relaci√≥n d√©bil. Tambi√©n se puede representar con un rombo doble. Adem√°s de que la cardinalidad m√≠nima ser√° 1, es muy com√∫n que en estos casos, la relaci√≥n tenga una cardinalidad de 1:N.
    
<figure markdown="span">
  <img src="images/02restriccion-id.png" width="80%">
  <figcaption>Restricci√≥n de ID</figcaption>
</figure>

En el ejemplo del gr√°fico tenemos una relaci√≥n que tiene una **restricci√≥n de identificaci√≥n** entre una l√≠nea de pedido (entidad d√©bil) respecto a un pedido (entidad fuerte). El pedido tendr√° un c√≥digo y un montante total que se calcula a partir de los valores de las l√≠neas de pedido. La propia restricci√≥n de identificaci√≥n implica que las l√≠neas de pedido realmente se identifican por su n√∫mero de l√≠nea y por el c√≥digo del pedido, por ejemplo la l√≠nea `1` del pedido `R2024A01`, la l√≠nea `2` del mismo pedido, etc... o la l√≠nea `1` de otro pedido diferente.

En las **restricciones de identificaci√≥n** es muy com√∫n que la entidad d√©bil se identifique mediante un n√∫mero o c√≥digo secuencial, el cual se reinicia por cada cambio de la entidad fuerte. Por ejemplo, pensemos en que todos los apartamentos de un edificio empiezan desde el n√∫mero `101`, pudiendo tener el apartamento `102` del edificio `E1` y el apartamento `102` del edificio `E2`, es decir, la entidad `APARTAMENTO` tiene una restricci√≥n de identificaci√≥n con `EDIFICIO`.

Pongamos otro ejemplo, si identificamos al alumnado por su n√∫mero de lista y por el grupo al que pertenecen, tendremos que no ser√° el mismo estudiante el n√∫mero `1` del grupo `1K` que el estudiante `1` del grupo `2K`, de manera que tendremos una restricci√≥n de identificaci√≥n entre la entidad `ESTUDIANTE` y la entidad `GRUPO`.

!!! question "D√©bil o fuerte"

    <img src="images/02restriccion-id-fuerte.png" width="40%" align="right">

    Hay casos en los que una entidad tiene relaci√≥n con varias entidades, comport√°ndose como d√©bil en una, y como fuerte en otras. Es por ello, que adem√°s de marcar la entidad como d√©bil, debemos marcar la relaci√≥n con un doble rombo.

    Ve√°moslo con un ejemplo. Si sobre la l√≠nea de pedido, a√±adimos una relaci√≥n 1:N con observaciones sobre la misma, tendr√≠amos el siguiente modelo, donde LINEA_PEDIDO es una entidad d√©bil respecto a la relaci√≥n CONTENER, pero hace de entidad fuerte respecto a la relaci√≥n TENER.


!!! info "Cardinalidades exactas"

    En ocasiones sabemos la cantidad exacta de ocurrencias con las que se puede relacionar una entidad. En dicho caso, seguir√°n siendo relaciones 1:N o N:M, pero en el modelo, indicaremos la cantidad de ocurrencias.

    Por ejemplo, si en una clase se matriculan un m√≠nimo de 5 estudiantes y un m√°ximo de 24, y un estudiante se matricula en al menos 2 clases y 6 como m√°ximo, tendremos:

    <figure markdown="span">
      <img src="images/02cardinalidades-exactas.png" width="60%">
      <figcaption>Restricci√≥n de ID</figcaption>
    </figure>


!!! tip "Supuesto III Empresa"

    Vamos a ampliar el sistema de informaci√≥n anterior para almacenar m√°s informaci√≥n. El nuevo sistema es:

    - La empresa est√° organizada en **departamentos**. Cada uno tiene un nombre √∫nico, el n√∫mero del despacho en el que se ubica y un empleado que lo dirige. Nos interesa la fecha que empez√≥ a dirigirlo.
    - Cada departamento **controla una serie de proyectos**, los cuales tienen nombre y n√∫mero √∫nicos.
    - De cada **empleado** nos interesa el DNI, nombre, fecha de nacimiento, salario y departamento en el que trabaja. Cada empleado puede trabajar en m√°s de un proyecto, dedic√°ndole un determinado n√∫mero de horas a la semana en cada proyecto.
    - Finalmente, queremos guardar tambi√©n los **familiares de cada empleado**, para administrar informaci√≥n relativa a las p√≥lizas de seguros. De los familiares, queremos saber el nombre, fecha de nacimiento y parentesco con el empleado.

    ??? solution "Soluci√≥n"

        Si volvemos a repetir el mismo proceso que hemos realizando anteriormente, vamos a localizar las entidades y las relaciones buscando los sustantivos y los verbos:

        - La empresa est√° organizada en departamentos. Cada uno tiene un nombre √∫nico, el n√∫mero del despacho en el que se ubica y un empleado que lo dirige. Nos interesa la fecha que empez√≥ a dirigirlo.
        - Cada departamento controla una serie de proyectos, los cuales tienen nombre y n√∫mero √∫nicos.
        - De cada empleado nos interesa el DNI, nombre, fecha de nacimiento, salario y departamento en el que trabaja. Cada empleado puede dedicarse a m√°s de un proyecto, facturando un determinado n√∫mero de horas a la semana a cada proyecto.
        - Finalmente, queremos guardar tambi√©n los familiares que tiene cada empleado, para administrar informaci√≥n relativa a las p√≥lizas de seguros. De los familiares, queremos saber el nombre, fecha de nacimiento y parentesco con el empleado.

        Resumiendo, hemos localizado: 
        
        - Entidades: EMPLEADO, DPTO, PROYECTO y FAMILIAR.
  
        Relaciones:

        - TRABAJAR entre EMPLEADO y DPTO.
        - SER_JEFE entre EMPLEADO y DPTO.
        - CONTROLAR entre DPTO y PROYECTO.
        - DEDICAR entre EMPLEADO y PROYECTO.
        - TENER entre EMPLEADO y FAMILIAR.
        
        Si nos centramos en las cardinalidades de las relaciones, tenemos:

        - Card(EMPLEADO, TRABAJAR) = (0, 1) y Card(DPTO, TRABAJAR) = (0, N)
        - Card(EMPLEADO, SER_JEFE) = (0, 1) y Card(DPTO, SER_JEFE) = (1, 1)
        - Card(DPTO, CONTROLAR) = (0, N) y Card(PROYECTO, CONTROLAR) = (1, 1)
        - Card(EMPLEADO, DEDICAR) = (0, N) y Card(PROYECTO, DEDICAR) = (1, N)
        - Card(EMPLEADO, TENER) = (0, N) y Card(FAMILIAR, TENER) = (1, 1)
        
        Finalmente, los atributos de las entidades y las relaciones son:

        - Atributos de EMPLEADO: dni (atributo identificador), nombre, fecha de nacimiento, salario.
        - Atributos de DPTO: nombre (atributo identificador), n√∫mero de despacho.
        - Atributos de PROYECTO: nombre y n√∫mero (ambos atributos identificadores).
        - Atributos de FAMILIAR: nombre (atributo identificador), fecha de nacimiento, parentesco.
        
        Atributos de las relaciones:
        
        - SER_JEFE: fecha de inicio
        - DEDICARSE: horas semanales
        
        Con estas consideraciones, el modelo resultante es:

        <figure markdown="span">
          <img src="images/02solucion-empresa2.png" width="80%">
          <figcaption>Soluci√≥n</figcaption>
        </figure>


#### P√©rdida expresiva

En ocasiones, los modelos conceptuales no son capaces de expresar todas las restricciones, relaciones o propiedades el mundo real, ya sea por algunas relaciones muy complejas, dependencias temporales o reglas de negocio.

Para ello, en el pie de los modelos indicaremos con texto una frase del estilo _"P√©rdida expresiva: Todo cliente debe haber nacido en la misma provincia que la tienda donde realiza el pedido"_.